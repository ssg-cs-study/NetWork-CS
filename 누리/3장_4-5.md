# ARP

### 사용 이유?

통신을 위해 사용되는 2계층 mac 주소와 3계층 ip주소는 관련이 없는 주소이다.

MAC 주소는 하드웨어 생산업체가 할당한 주소이고, IP주소는 직접 할당하거나 자동으로 할당받는다.

호스트에서 처음 통신을 시도하면 상대방의 MAC 주소를 알 수 없어 2계층 캡슐화를 수행할 수 없다.

이때 상대방의 MAC 주소를 알아내기 위해 ARP 브로드캐스트를 이용한다.

### ARP 테이블

- 패킷 전송때마타 ARP 브로드캐스트를 수행하면 네트워크 효율성 ⬇
- 메모리에 이 정보를 두고 재사용
- 하지만 ip 주소는 바뀔 수 있어 일정 시간동안 통신 없으면 삭제

## ARP 동작

### ARP 프로토콜 필드

![image](https://github.com/ssg-cs-study/NetWork-CS/assets/83645234/c3322ae4-1d13-4cf1-86af-90cb142f5e9e)

### 동일 네트워크 내의 ARP

서브네팅으로 동일네크워크 여부를 파악한다.

A → B 서버로 처음 요청을 보내고자 할 때

- 서버 A는 목적지인 서버 B의 mac 주소를 알아내기 위해 ARP 요청을 네트워크에 브로드캐스트 한다.
- 요청 패킷은
    - 2계층 mac주소 출발지: 자신의 mac 주소
    - 2계층 mac주소 도착지: 브로드캐스트 주소 (FF-FF-FF-FF-FF-FF)
    - ARP 필드
        - 전송자 mac, ip : 자신의 주소
        - 대상자 mac: 00-00-00-00-00-00
        - 대상자 ip: 대상자 ip 주소
- ARP 패킷은 네트워크 내부 모든 단말에 보내고, 자신이 아니면  패킷을 버린다
- 서버 B에서는 ARP 요청을 처리하고 응답을 보낸다.

### 다른 네트워크에서 ARP

원격 네트워크 통신은 브로드캐스트로 전달되지 못한다.

ARP 요청을 기본 게이트웨이의 ip 주소로 요청

프록시 ARP 기능(라우터 기본 설정)

![image](https://github.com/ssg-cs-study/NetWork-CS/assets/83645234/d7a9918b-741f-4e61-b9d4-58e186e3452a)

![image](https://github.com/ssg-cs-study/NetWork-CS/assets/83645234/a247b3c0-451b-482a-bdbd-96f64bd78010)

- 원격 통신의 경우 목적지의 IP와 MAC주소가 일치하지 않다. (목적지의 MAC 주소는 게이트웨이의 주소가 됨)

### GARP

GARP는 자신의 IP와 MAC주소를 알리는 목적으로 사용

GARP 패킷은

- 전송자 MAC : 자신의 MAC 주소
- 전송자 IP : 자신의 IP
- 대상자 MAC : 00-00-00-00-00-00
- 대상자 IP : 자신의 IP(출발지와 목적지의 IP가 모두 자신의 IP로 동일하다.)

정보를 넣어 네트워크에 브로드캐스트한다.

## 사용 이유

1. IP 주소 출동 감지
2. 상대방 ARP 테이블 갱신
3. 데이터베이스 HA 솔루션 (실제 MAC 사용)
    - 최근에는 보안상의 문제로 가상 MAC 사용
    - 두 데이터베이스 서버가 하나의 가상 IP주소로 서비스
    - 한대만 동작하고 나머지 한대는 대기
    - 액티브 데이터베이스를 바꿀 때 사용
    - 단말의 ARP 테이블 갱신
4. 가상 MAC 주소, VRRP, HSRP
    - 단말은 ARP 정보를 가상 MAC 주소로 학습하므로 단말의 ARP 테이블을 갱신할 필요 없다
    - 대신 클러스터링 중간의 스위치의 MAC 테이블 갱신 필요!
    
![image](https://github.com/ssg-cs-study/NetWork-CS/assets/83645234/465e53b1-a505-4a42-937b-c7bd6f514aa6)

    

### RARP

ip 주소가 정해지지 않은 단말이 ip 할당 요청시 사용

현재는 BOOTP와 DHCP로 대체되어 사용되지 않는다.

# 2계층 통신, 3계층 통신

로컬 네트워크 안에서 통신할 경우 2계층 통신 가능

원격 네트워크와 통신해야 할 경우 3계층 통신 필요
